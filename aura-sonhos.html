<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aura Sonhos</title>
<link rel="icon" href="images/favicon.ico" type="image/x-icon">

<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: #0a0a12;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

/* MINI PLAYER */
#miniPlayer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(20,20,30,0.85);
    backdrop-filter: blur(12px);
    padding: 10px 15px;
    border-radius: 16px;
    display: flex;
    gap: 10px;
    align-items: center;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    z-index: 9999;
}

#miniPlayer button {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

#miniPlayer input {
    width: 80px;
}

/* SVG animation setup */
.aura-sonhos-animation-star-wrapper {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-star {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-lori {
    transform-box: fill-box;
    transform-origin: center bottom;
}
</style>
</head>

<body>

<audio id="aura-music" loop>
    <source src="music/lofi.mp3" type="audio/mpeg">
</audio>

<!-- MINI PLAYER -->
<div id="miniPlayer">
    <button id="playPause">â–¶</button>
    <button id="muteBtn">ðŸ”Š</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.4">
</div>

<!-- SVG RESPONSIVO -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2650 2463" preserveAspectRatio="xMidYMid meet" width="100%" height="100%" style="position:absolute; top:0; left:0;">
    <!-- AURA -->
    <image class="aura-sonhos-animation-lori" href="images/aura.png" width="2650" height="2463" preserveAspectRatio="xMidYMid meet"/>
    
    <!-- ESTRELA -->
    <g class="aura-sonhos-animation-star-wrapper">
        <!-- x e y agora absolutos dentro do viewBox, width proporcional -->
        <image class="aura-sonhos-animation-star" href="images/star.png" width="341" height="347" x="1900" y="620"/>
    </g>
</svg>

<script>
const star = document.querySelector(".aura-sonhos-animation-star");
const starWrapper = document.querySelector(".aura-sonhos-animation-star-wrapper");
const lori = document.querySelector(".aura-sonhos-animation-lori");
const music = document.getElementById("aura-music");

const playPause = document.getElementById("playPause");
const muteBtn = document.getElementById("muteBtn");
const volumeSlider = document.getElementById("volumeSlider");

let audioContext;
let analyser;
let dataArray;
let audioInitialized = false;

/* ORIGINAL ANIMATIONS */
var rotateAnim = new Animation(
    new KeyframeEffect(
        starWrapper,
        { transform: ['rotate(-15deg)', 'rotate(7deg)'] },
        { duration: 1250, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity }
    )
);

var floatAnim = new Animation(
    new KeyframeEffect(
        star,
        { transform: ['translateY(-60px)', 'translateY(10px)'] },
        { duration: 2500, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity }
    )
);

var breatheAnim = new Animation(
    new KeyframeEffect(
        lori,
        { transform: ['scaleY(1)', 'scaleY(0.99)'] },
        { duration: 2000, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity }
    )
);

rotateAnim.play();
floatAnim.play();
breatheAnim.play();

/* MINI PLAYER CONTROLS + AUDIO INIT */
playPause.addEventListener("click", async () => {

    if (!audioInitialized) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementSource(music);

        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;

        source.connect(analyser);
        analyser.connect(audioContext.destination);

        dataArray = new Uint8Array(analyser.frequencyBinCount);
        music.volume = 0.4;

        audioInitialized = true;
        animateAudio();
    }

    if (music.paused) {
        music.play();
        playPause.textContent = "â¸";
    } else {
        music.pause();
        playPause.textContent = "â–¶";
    }
});

muteBtn.addEventListener("click", () => {
    music.muted = !music.muted;
    muteBtn.textContent = music.muted ? "ðŸ”‡" : "ðŸ”Š";
});

volumeSlider.addEventListener("input", () => {
    music.volume = volumeSlider.value;
});

/* AUDIO REACTIVE STAR */
function animateAudio() {
    requestAnimationFrame(animateAudio);

    if (!analyser) return;

    analyser.getByteFrequencyData(dataArray);

    let sum = 0;
    for (let i = 0; i < dataArray.length; i++) sum += dataArray[i];

    let average = sum / dataArray.length;
    let reactiveScale = 1 + (average / 400);
    let glow = average * 2;

    star.style.scale = reactiveScale;

    star.style.filter = `
        drop-shadow(0px 0px ${glow}px #fde633)
        drop-shadow(0px 0px ${glow * 1.5}px #fde633)
    `;
}

/* PARALLAX */
document.addEventListener("mousemove", (e) => {

    const x = (e.clientX / window.innerWidth - 0.5);
    const y = (e.clientY / window.innerHeight - 0.5);

    lori.style.translate = `${x * 10}px ${y * 10}px`;
    starWrapper.style.translate = `${x * 25}px ${y * 25}px`;
});
</script>

</body>
</html>
