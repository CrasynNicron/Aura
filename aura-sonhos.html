<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aura Sonhos</title>
<link rel="icon" href="images/favicon.ico" type="image/x-icon">

<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: #0a0a12;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

/* MINI PLAYER */
#miniPlayer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(20,20,30,0.85);
    backdrop-filter: blur(12px);
    padding: 10px 15px;
    border-radius: 16px;
    display: flex;
    gap: 10px;
    align-items: center;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    z-index: 9999;
}

#miniPlayer button {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

#miniPlayer input {
    width: 80px;
}

/* SVG animation setup */
.aura-sonhos-animation-star-wrapper {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-star {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-lori {
    transform-box: fill-box;
    transform-origin: center bottom;
    width: 100%;
    height: 100%;
}
</style>
</head>

<body>

<!-- MINI PLAYER -->
<div id="miniPlayer">
    <button id="playPause">‚ñ∂</button>
    <button id="muteBtn">üîä</button>
    <button id="shuffleBtn">üîÄ</button>
    <button id="repeatBtn">üîÅ</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.4">
</div>

<!-- AUDIO -->
<audio id="aura-music" loop></audio>

<!-- SVG RESPONSIVO -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2650 2463" preserveAspectRatio="xMidYMid meet" width="100%" height="100%" style="position:absolute; top:0; left:0; z-index:0;">
    <!-- AURA -->
    <image class="aura-sonhos-animation-lori" href="images/aura.png" width="2650" height="2463" preserveAspectRatio="xMidYMid meet"/>
    
    <!-- ESTRELA -->
    <g class="aura-sonhos-animation-star-wrapper">
        <image class="aura-sonhos-animation-star" href="images/star.png" width="341" height="347" x="1900" y="620"/>
    </g>
</svg>

<script>
const star = document.querySelector(".aura-sonhos-animation-star");
const starWrapper = document.querySelector(".aura-sonhos-animation-star-wrapper");
const lori = document.querySelector(".aura-sonhos-animation-lori");
const music = document.getElementById("aura-music");

const playPause = document.getElementById("playPause");
const muteBtn = document.getElementById("muteBtn");
const volumeSlider = document.getElementById("volumeSlider");
const shuffleBtn = document.getElementById("shuffleBtn");
const repeatBtn = document.getElementById("repeatBtn");

let audioContext;
let analyser;
let dataArray;
let audioInitialized = false;
let shuffle = false;
let repeat = false;
let playlist = ['music/lofi1.mp3','music/lofi2.mp3','music/lofi3.mp3'];
let currentTrack = 0;

/* ORIGINAL ANIMATIONS */
var rotateAnim = new Animation(
    new KeyframeEffect(starWrapper, { transform: ['rotate(-15deg)', 'rotate(7deg)'] }, { duration: 1250, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity })
);
var floatAnim = new Animation(
    new KeyframeEffect(star, { transform: ['translateY(-60px)', 'translateY(10px)'] }, { duration: 2500, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity })
);
var breatheAnim = new Animation(
    new KeyframeEffect(lori, { transform: ['scaleY(1)', 'scaleY(0.99)'] }, { duration: 2000, easing: 'ease-in-out', direction: 'alternate', iterations: Infinity })
);

rotateAnim.play();
floatAnim.play();
breatheAnim.play();

/* TEMA ESCURO/CLARO AUTOM√ÅTICO */
function setThemeByTime() {
    const hour = new Date().getHours();
    if (hour >= 7 && hour < 19) { // dia
        document.body.style.background = '#87ceeb';
        document.querySelector('#miniPlayer').style.background = 'rgba(255,255,255,0.85)';
        document.querySelector('#miniPlayer').style.color = '#000';
        star.style.opacity = 0.2;
    } else { // noite
        document.body.style.background = '#0a0a12';
        document.querySelector('#miniPlayer').style.background = 'rgba(20,20,30,0.85)';
        document.querySelector('#miniPlayer').style.color = '#fff';
        star.style.opacity = 1;
    }
}
setThemeByTime();

/* FUN√á√ÉO DE TOCAR PR√ìXIMA M√öSICA */
function playNext() {
    if (shuffle) {
        currentTrack = Math.floor(Math.random() * playlist.length);
    } else {
        currentTrack = (currentTrack + 1) % playlist.length;
    }
    music.src = playlist[currentTrack];
    music.play();
}

/* MINI PLAYER CONTROLS + AUDIO INIT */
playPause.addEventListener("click", async () => {
    if (!audioInitialized) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementSource(music);
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
        audioInitialized = true;
        animateAudio();
        music.src = playlist[currentTrack];
    }
    if (music.paused) {
        music.play();
        playPause.textContent = "‚è∏";
    } else {
        music.pause();
        playPause.textContent = "‚ñ∂";
    }
});

muteBtn.addEventListener("click", () => {
    music.muted = !music.muted;
    muteBtn.textContent = music.muted ? "üîá" : "üîä";
});

volumeSlider.addEventListener("input", () => music.volume = volumeSlider.value);

/* SHUFFLE / REPEAT BUTTONS */
shuffleBtn.addEventListener("click", () => shuffle = !shuffle);
repeatBtn.addEventListener("click", () => repeat = !repeat);

/* MUDAR M√öSICA QUANDO ACABA */
music.addEventListener('ended', () => {
    if (repeat) {
        music.play();
    } else {
        playNext();
    }
});

/* VOLUME COM SCROLL DO RATO */
document.addEventListener('wheel', (e) => {
    music.volume = Math.min(1, Math.max(0, music.volume + (e.deltaY < 0 ? 0.05 : -0.05)));
    volumeSlider.value = music.volume;
});

/* AUDIO REACTIVE STAR */
function animateAudio() {
    requestAnimationFrame(animateAudio);
    if (!analyser) return;
    analyser.getByteFrequencyData(dataArray);
    let sum = 0;
    for (let i = 0; i < dataArray.length; i++) sum += dataArray[i];
    let average = sum / dataArray.length;
    let reactiveScale = 1 + (average / 400);
    let glow = average * 2;
    star.style.scale = reactiveScale;
    star.style.filter = `
        drop-shadow(0px 0px ${glow}px #fde633)
        drop-shadow(0px 0px ${glow * 1.5}px #fde633)
    `;
}

/* PARALLAX */
document.addEventListener("mousemove", (e) => {
    const x = (e.clientX / window.innerWidth - 0.5);
    const y = (e.clientY / window.innerHeight - 0.5);
    lori.style.translate = `${x * 10}px ${y * 10}px`;
    starWrapper.style.translate = `${x * 25}px ${y * 25}px`;
});

/* FUTURO: Hooks para part√≠culas 3D e transi√ß√µes de cena */
</script>

</body>
</html>
