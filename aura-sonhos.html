<!-- ===[ CSS ]=== -->
<style>
body {
    margin: 0;
    background: #0a0a12;
    overflow: hidden;
}

#audioButton {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 18px;
    background: #111827;
    color: white;
    border: 1px solid #333;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    z-index: 999;
}

#audioButton:hover {
    background: #1f2937;
}

.aura-sonhos-animation-star-wrapper {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-star {
    transform-box: fill-box;
    transform-origin: 52% 49%;
}

.aura-sonhos-animation-lori {
    transform-box: fill-box;
    transform-origin: center bottom;
}
</style>

<!-- ===[ AUDIO BUTTON ]=== -->
<button id="audioButton">ðŸŽµ Enable Lofi Mode</button>

<audio id="aura-music" loop>
    <source src="music/lofi.mp3" type="audio/mpeg">
</audio>

<!-- ===[ SVG ]=== -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2650 2463" preserveAspectRatio="xMidYMid meet">
    <image class="aura-sonhos-animation-lori" href="images/aura.png" width="2650" height="2463"/>
    <g class="aura-sonhos-animation-star-wrapper">
        <image class="aura-sonhos-animation-star" href="images/star.png" width="341" height="347" x="1900" y="620"/>
    </g>
</svg>

<!-- ===[ SCRIPT ]=== -->
<script>
const star = document.querySelector(".aura-sonhos-animation-star");
const starWrapper = document.querySelector(".aura-sonhos-animation-star-wrapper");
const lori = document.querySelector(".aura-sonhos-animation-lori");
const music = document.getElementById("aura-music");
const button = document.getElementById("audioButton");

let audioContext;
let analyser;
let dataArray;

// === TUA animaÃ§Ã£o original (rotaÃ§Ã£o estrela) ===
var animation = new Animation(
    new KeyframeEffect(
        starWrapper,
        { transform: ['rotate(-15deg)', 'rotate(7deg)'] },
        {
            duration: 1250,
            fill: 'forwards',
            easing: 'ease-in-out',
            direction: 'alternate',
            iterations: Infinity,
        }
    )
);

// === TUA animaÃ§Ã£o original (subir/descer estrela) ===
var animation2 = new Animation(
    new KeyframeEffect(
        star,
        {
            transform: ['translateY(-60px)', 'translateY(10px)']
        },
        {
            duration: 2500,
            fill: 'forwards',
            easing: 'ease-in-out',
            direction: 'alternate',
            iterations: Infinity,
        }
    )
);

// === TUA animaÃ§Ã£o original (respiraÃ§Ã£o Lori) ===
var scaleAnim = new Animation(
    new KeyframeEffect(
        lori,
        { transform: ['scaleY(1)', 'scaleY(0.99)'] },
        {
            duration: 2000,
            fill: 'forwards',
            easing: 'ease-in-out',
            direction: 'alternate',
            iterations: Infinity,
        }
    )
);

animation.play();
animation2.play();
scaleAnim.play();

// === AUDIO REACTIVE ===
button.addEventListener("click", async () => {

    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaElementSource(music);

    analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;

    source.connect(analyser);
    analyser.connect(audioContext.destination);

    const bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    music.volume = 0.4;
    music.play();

    animateAudio();

    button.style.display = "none";
});

function animateAudio() {
    requestAnimationFrame(animateAudio);

    analyser.getByteFrequencyData(dataArray);

    let sum = 0;
    for (let i = 0; i < dataArray.length; i++) {
        sum += dataArray[i];
    }

    let average = sum / dataArray.length;

    let reactiveScale = 1 + (average / 400); // mais suave
    let glow = average * 2;

    star.style.scale = reactiveScale;

    star.style.filter = `
        drop-shadow(0px 0px ${glow}px #fde633)
        drop-shadow(0px 0px ${glow * 1.5}px #fde633)
    `;
}
</script>
